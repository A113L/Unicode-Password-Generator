<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNICODE Password Utility</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Font Setup */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }

        /* --- Custom Slider Styles --- */
        .slider-container input[type="range"] {
            /* Webkit (Chrome/Safari) */
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #4f46e5; /* Tailwind indigo-600 for track */
            border-radius: 5px;
            outline: none;
            transition: opacity .2s;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #c7d2fe; /* Tailwind indigo-200 for thumb */
            cursor: pointer;
            border: 2px solid #fff;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }

        .slider-container input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #c7d2fe;
            cursor: pointer;
            border: 2px solid #fff;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        /* --- End Custom Slider Styles --- */


        /* Hide number input spinners */
        input[type='number']::-webkit-inner-spin-button,
        input[type='number']::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type='number'] {
            -moz-appearance: textfield;
        }
        /* Custom scrollbar styling for the code block (for the bash script) */
        .code-block::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        .code-block::-webkit-scrollbar-track {
            background: #2d3748; /* bg-gray-700 equivalent */
            border-radius: 10px;
        }
        .code-block::-webkit-scrollbar-thumb {
            background: #4a5568; /* bg-gray-600 equivalent */
            border-radius: 10px;
        }
        .code-block::-webkit-scrollbar-thumb:hover {
            background: #718096; /* bg-gray-500 equivalent */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-4xl bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-10 border border-indigo-700/50">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold text-indigo-400 mb-2 tracking-tight">
                UNICODE Password Utility
            </h1>
            <p class="text-xl text-gray-400">
                Cryptographically secure generation using configurable character sets.
            </p>
        </header>

        <!-- Generation Parameters -->
        <section class="mb-8 p-6 bg-gray-700 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold text-gray-100 mb-4 border-b border-indigo-600 pb-2">Generation Settings</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                
                <!-- Password Length Controller -->
                <div>
                    <label for="length-input" class="block text-sm font-medium text-gray-300 mb-2">
                        Password Length: <span id="length-display" class="text-indigo-400 font-bold">20</span>
                    </label>
                    <div class="flex space-x-3 items-center slider-container">
                        <!-- Range Slider -->
                        <input type="range" id="length-slider" min="8" max="128" value="20" step="1" class="flex-grow">
                        
                        <!-- Text Input -->
                        <input type="number" id="length-input" value="20" min="8" max="128"
                               class="w-20 p-2 rounded-lg bg-gray-600 border border-gray-500 text-gray-100 text-center focus:ring-indigo-500 focus:border-indigo-500 appearance-none transition duration-150">
                    </div>
                    <p class="mt-1 text-sm text-gray-400">Recommended: 16 to 32 characters.</p>
                </div>

                <!-- Number of Passwords Controller -->
                <div>
                    <label for="count-input" class="block text-sm font-medium text-gray-300 mb-2">
                        Number of Passwords: <span id="count-display" class="text-indigo-400 font-bold">3</span>
                    </label>
                    <div class="flex space-x-3 items-center slider-container">
                        <!-- Range Slider (Max set to 100 for better slider control, input allows 10000) -->
                        <input type="range" id="count-slider" min="1" max="100" value="3" step="1" class="flex-grow">
                        
                        <!-- Text Input -->
                        <input type="number" id="count-input" value="3" min="1" max="10000"
                               class="w-20 p-2 rounded-lg bg-gray-600 border border-gray-500 text-gray-100 text-center focus:ring-indigo-500 focus:border-indigo-500 appearance-none transition duration-150">
                    </div>
                    <p class="mt-1 text-sm text-gray-400">Generate up to 10,000 passwords at once.</p>
                </div>
            </div>

            <!-- Character Set Options -->
            <h3 class="text-xl font-bold text-gray-200 mb-3 border-t pt-4 border-gray-600">Included Character Sets</h3>
            <div id="charset-options" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 text-sm">
                <!-- Checkboxes will be dynamically inserted here by JavaScript -->
            </div>
            <p id="charset-warning" class="mt-3 text-sm text-orange-400 font-semibold hidden">
                <span class="inline-block w-4 h-4 mr-1 bg-yellow-500 rounded-full animate-pulse"></span>
                Warning: You must select at least one character set.
            </p>

            <!-- Generate Button -->
            <button id="generate-button"
                    class="mt-8 w-full py-4 text-xl font-bold rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white transition duration-300 transform hover:scale-[1.01] shadow-xl shadow-indigo-500/30 disabled:bg-indigo-400 disabled:shadow-none disabled:transform-none flex items-center justify-center">
                <span id="generate-text">Generate Passwords</span>
                <svg id="loading-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </button>
        </section>

        <!-- Entropy and Strength Display -->
        <section class="mb-8 p-6 bg-gray-700 rounded-xl shadow-lg grid grid-cols-1 md:grid-cols-3 gap-4">

            <!-- Pool Size -->
            <div class="bg-gray-600 p-4 rounded-lg">
                <p class="text-sm font-medium text-gray-300">Active Character Pool Size</p>
                <p id="pool-size" class="text-2xl font-extrabold text-white mt-1">...</p>
            </div>
            <!-- Entropy -->
            <div class="bg-gray-600 p-4 rounded-lg">
                <p class="text-sm font-medium text-gray-300">Logarithmic Entropy (Bits)</p>
                <p id="entropy-bits" class="text-2xl font-extrabold text-white mt-1">0.00 bits</p>
            </div>
            <!-- Strength Rating -->
            <div class="bg-gray-600 p-4 rounded-lg">
                <p class="text-sm font-medium text-gray-300">Estimated Strength Rating</p>
                <p id="strength-rating" class="text-2xl font-extrabold text-red-500 mt-1">N/A</p>
            </div>
        </section>

        <!-- Password Output -->
        <section class="mb-8 p-6 bg-gray-800 rounded-xl">
            <h2 class="text-2xl font-bold text-gray-100 mb-4 border-b border-indigo-600 pb-2">Generated Passwords</h2>
            <div id="password-output" class="space-y-3">
                <p class="text-gray-400 text-center py-4">Click "Generate Passwords" to begin.</p>
            </div>

            <!-- Secure Storage Warning -->
            <div class="mt-8 p-4 bg-red-900/40 border border-red-700 rounded-lg shadow-inner">
                <p class="text-lg font-bold text-red-300 flex items-center mb-1">
                    <!-- Lock Icon -->
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 8a6 6 0 01-7.743 5.743L10 14l-.257-.257A6 6 0 1118 8zm-7.414 2.586a1 1 0 00-1.414 1.414l.707.707-.707.707a1 1 0 001.414 1.414l.707-.707 1.414 1.414a1 1 0 001.414-1.414l-.707-.707.707-.707a1 1 0 00-1.414-1.414l-.707.707-.707-.707z" clip-rule="evenodd"></path></svg>
                    CRITICAL: Secure Storage Required
                </p>
                <p class="text-sm text-red-200">
                    These passwords are for high-security use. Do not store them unencrypted. We strongly recommend using a reputable, open-source password manager like <a href="https://keepass.info/" target="_blank" class="text-red-100 underline hover:text-red-500 font-semibold">KeePass</a> or <a href="https://bitwarden.com/" target="_blank" class="text-red-100 underline hover:text-red-500 font-semibold">Bitwarden</a>.
                </p>
                <!-- FDE SECTION -->
                <div class="mt-4 pt-4 border-t border-red-800">
                    <p class="text-md font-extrabold text-red-100 mb-1">
                        Full Disk Encryption (FDE) is Mandatory
                    </p>
                    <p class="text-sm text-red-200">
                        As a baseline defense, ensure **Full Disk Encryption (FDE)** (e.g., BitLocker, FileVault, LUKS) is active on your device. FDE prevents unauthorized access if the device is physically lost or stolen, making all data, including your password manager and sensitive files, unreadable without the correct key.
                    </p>
                </div>
            </div>

            <!-- Download Section -->
            <div id="download-section" class="mt-6 pt-4 border-t border-gray-700">
                <button id="download-button" class="w-full py-3 text-lg font-semibold rounded-lg bg-teal-600 hover:bg-teal-700 text-white transition duration-300 shadow-lg flex items-center justify-center">
                    <!-- Download Icon -->
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                    Download Passwords List (<span id="download-count">0</span>) (.txt)
                </button>
            </div>
        </section>

        <!-- BASH SCRIPT FILE ENCRYPTION GUIDE SECTION -->
        <section class="mt-4 p-6 bg-gray-700 rounded-2xl shadow-2xl">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 border-b border-indigo-600 pb-2">
                <h2 class="text-3xl font-bold text-red-300 flex items-center mb-2 sm:mb-0">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                    Bash Script: File Protection Utility
                </h2>
                <button id="copy-bash-button" class="flex items-center space-x-2 px-4 py-2 bg-red-600 text-white text-sm font-semibold rounded-lg shadow-md hover:bg-red-700 transition duration-150 transform hover:scale-[1.02] active:scale-[0.98]">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                        <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                    </svg>
                    <span>Copy Script</span>
                </button>
            </div>
            <p class="text-gray-300 mb-4">
                This interactive Bash script uses **OpenSSL (AES-256-CBC)** for strong encryption of files. The encryption now uses **PBKDF2** for key derivation to prevent brute-force attacks.
            </p>

            <!-- Bash Script Code Block -->
            <div class="bg-gray-900 text-green-300 rounded-xl shadow-inner code-block p-4 overflow-x-auto border border-gray-700 mb-6">
                <pre><code id="bash-script-code" class="font-mono text-sm whitespace-pre-wrap">#!/bin/bash
# -----------------------------------------------------------------------------
# Interactive File Protector Script (Encryption/Decryption)
# Dependencies: Requires the 'openssl' command-line tool.
# Usage: Run in terminal: bash file_protector.sh
# -----------------------------------------------------------------------------

# Configuration
ENCRYPT_EXT=".enc"
CIPHER_METHOD="aes-256-cbc"

# --- Utility Functions ---

# Function to display error messages
error_message() {
    echo -e "\n\033[31m[ERROR]\033[0m $1"
}

# Function to get secure password input
get_password() {
    read -rsp "Enter password (will not be visible): " PASSWORD
    echo "" # Add a newline after secure input
}

# --- Core Logic ---

# 1. Encrypts a file
encrypt_file() {
    echo -e "\n--- File Encryption ---"
    read -rp "Enter the filename to encrypt (e.g., secret.txt): " INPUT_FILE

    if [ ! -f "$INPUT_FILE" ]; then
        error_message "File '$INPUT_FILE' not found."
        return 1
    fi

    OUTPUT_FILE="${INPUT_FILE}${ENCRYPT_EXT}"
    get_password
    echo -e "\nEncrypting '$INPUT_FILE' to '$OUTPUT_FILE'..."

    # Use openssl with PBKDF2 for robust key derivation
    if openssl enc -"$CIPHER_METHOD" -salt -pbkdf2 -in "$INPUT_FILE" -out "$OUTPUT_FILE" -k "$PASSWORD"; then
        echo -e "\033[32m[SUCCESS]\033[0m File encrypted successfully!"
        read -rp "Do you want to securely delete the original file '$INPUT_FILE'? (y/N): " DELETE_CONFIRM
        if [[ "$DELETE_CONFIRM" =~ ^[Yy]$ ]]; then
            # Check for 'shred' utility to perform secure, multi-pass file deletion.
            if command -v shred >/dev/null 2>&1; then
                # -u ensures file is overwritten, renamed, and deleted
                shred -u "$INPUT_FILE"
                echo -e "\033[33m[WARNING]\033[0m Original file securely deleted using shred (multi-pass overwrite)."
            else
                # Fallback to standard removal if shred is not found (less secure)
                rm -f "$INPUT_FILE"
                echo -e "\033[33m[WARNING]\033[0m Original file deleted using standard 'rm' (less secure)."
            fi
        fi
    else
        error_message "Encryption failed. Check your file path or permissions."
    fi
}

# 2. Decrypts a file
decrypt_file() {
    echo -e "\n--- File Decryption ---"
    read -rp "Enter the encrypted filename (e.g., secret.txt.enc): " INPUT_FILE

    if [ ! -f "$INPUT_FILE" ]; then
        error_message "File '$INPUT_FILE' not found."
        return 1
    fi

    # Determine output filename by stripping the encryption extension
    OUTPUT_FILE="${INPUT_FILE%$ENCRYPT_EXT}"
    if [ "$OUTPUT_FILE" == "$INPUT_FILE" ]; then
        error_message "Input file does not end with '$ENCRYPT_EXT'. Specify the output filename manually."
        read -rp "Enter the desired output filename: " OUTPUT_FILE
        if [ -z "$OUTPUT_FILE" ]; then
            error_message "No output filename provided. Aborting decryption."
            return 1
        }
    fi

    if [ -f "$OUTPUT_FILE" ]; then
        error_message "Output file '$OUTPUT_FILE' already exists. Aborting to prevent overwrite."
        return 1
    fi

    get_password
    echo -e "\nDecrypting '$INPUT_FILE' to '$OUTPUT_FILE'..."

    # Use openssl to decrypt, including -pbkdf2 to match the encryption method
    if openssl enc -d -"$CIPHER_METHOD" -pbkdf2 -in "$INPUT_FILE" -out "$OUTPUT_FILE" -k "$PASSWORD"; then
        echo -e "\033[32m[SUCCESS]\033[0m File decrypted successfully!"
    else
        error_message "Decryption failed. Check your password or file integrity."
    fi
}

# --- Main Menu ---

main_menu() {
    echo "========================================="
    echo "        File Protection Utility (Bash)     "
    echo "========================================="
    echo "1. Encrypt a File"
    echo "2. Decrypt a File"
    echo "3. Exit"
    echo "========================================="

    read -rp "Enter your choice (1-3): " CHOICE

    case "$CHOICE" in
        1)
            encrypt_file
            main_menu
            ;;
        2)
            decrypt_file
            main_menu
            ;;
        3)
            echo -e "\nGoodbye! Data security is important."
            exit 0
            ;;
        *)
            error_message "Invalid choice. Please enter 1, 2, or 3."
            main_menu
            ;;
    esac
}

# Start the main script process
main_menu</code></pre>
            </div>
                        <h3 class="text-xl font-semibold text-gray-100 mb-3 border-t pt-4 border-gray-600">How to Use the Script:</h3>
            <ol class="list-decimal list-inside space-y-2 text-gray-400">
                <li>Click **Copy Script** above.</li>
                <li>Save the copied code to a file named <code class="bg-gray-900 px-1 py-0.5 rounded text-sm font-mono text-indigo-400">file_protector.sh</code> on your Linux or macOS machine.</li>
                <li>Make the script executable: <code class="bg-gray-900 px-1 py-0.5 rounded text-sm font-mono text-indigo-400">chmod +x file_protector.sh</code></li>
                <li>Run the script from your terminal: <code class="bg-gray-900 px-1 py-0.5 rounded text-sm font-mono text-indigo-400">./file_protector.sh</code></li>
            </ol>
            <p class="mt-4 text-sm text-red-400 font-medium">
                <strong class="font-bold">Note:</strong> This script requires the <code class="bg-gray-900 px-1 py-0.5 rounded text-sm font-mono text-indigo-400">openssl</code> utility (with PBKDF2 support) and the <code class="bg-gray-900 px-1 py-0.5 rounded text-sm font-mono text-indigo-400">shred</code> utility (for secure deletion) to be installed.
            </p>

        </section>
    </div>

    <!-- Notification element for the Bash script copy action (must be outside the main div) -->
    <div id="bash-copy-notification" class="hidden fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-indigo-700 text-white px-4 py-2 rounded-lg shadow-xl transition-opacity duration-300 z-50 opacity-0 font-semibold">
        Content copied to clipboard!
    </div>

    <script>
        // --- Rate Limiting Constants ---
        const COOLDOWN_MS = 500; // 500 milliseconds cool-down between generations
        let lastGenerationTime = 0; // Timestamp of the last successful generation attempt
        
        // --- Character Pool Definitions (Refactored for clarity) ---
        const CHAR_SETS = {
            'Latin (Standard)': {
                value: "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~",
                enabled: true, // Default enabled
                description: 'English, numbers, and standard symbols.'
            },
            'Latin (Extended)': {
                value: "ąćęłńóśźżĄĆĘŁŃÓŚŹŻäöüßÄÖÜèéêëēėęùúûüūîïíīįìôöòóœøãåáàâæçñ",
                enabled: false,
                description: 'Western and Central European accents.'
            },
            'Cyrillic': {
                value: "абвгдеёжзийклмнопрстуфхцчшщъыьэюяАБВГДЕЁЖЗИЙКЛМНОПРСТФХЦЧШЩЪЫЬЭЮЯ",
                enabled: false,
                description: 'Russian and related languages.'
            },
            'Asian (CJK, Hiragana, Katakana)': {
                value: "漢字日本語中文测试字符あいうえおかきくけこさしすせそたちつてとなにぬねのアイウエオカキクケコサシスセソタチツテトナニヌネノ",
                enabled: false,
                description: 'Chinese, Japanese, and Korean characters.'
            },
            'Greek/Coptic/Hebrew': {
                value: "ΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩαβγδελμνξοπρςστυφχψω",
                enabled: false,
                description: 'Greek and related script characters.'
            },
            'Math/Symbols': {
                value: "∞±≠∑∏√∫∂∆πµΩ≈≡≤≥∇¢£¥€₩₪₹₽฿₫₴₦₲∀∁∂∃∄∅∆∇∈∉∊∋∌∍∎∏∐∑−∓∔∕∖∗∘∙√∛∜∝∞∟∠∡∢∣∤∥∦∧∨∩∪∫∬∭∮∯∰∱∲∳∴∵∶∷∸∹∺∻∼∽∾∿≀≁≂≃≄≅≆≇≈≉≊≋≌≍≎≏≐≑≒≓≔≕≖≗≘≙≚≛≜≝≞≟≠≡≢≣≤≥≦≧≨≩≪≫≬≭≮≯≰≱≲≳≴≵≶≷≸≹≺≻≼≽≾≿⊀⊁⊂⊃⊄⊅⊆⊇⊈⊉⊊⊋⊌⊍⊎⊏⊐⊑⊒⊓⊔⊕⊖⊗⊘⊙⊚⊛⊜⊝⊞⊟⊠⊡⊢⊣⊤⊥⊦⊧⊨⊩⊪⊫⊬⊭⊮⊯⊰⊱⊲⊳⊴⊵⊶⊷⊸⊹⊺⊻⊼⊽⊾⊿⋀⋁⋂⋃⋄⋅⋆⋇⋈⋉⋊⋋⋌⋍⋎⋏⋐⋑⋒⋓⋔⋕⋖⋗⋘⋙⋚⋛⋜⋝⋞⋟⋠⋡⋢⋣⋤⋥⋦⋧⋨⋩⋪⋫⋬⋭⋮⋯⋰⋱",
                enabled: false,
                description: 'Mathematical operators and currency symbols.'
            },
            'Box & Geometric': {
                value: "─━│┃┄┅┆┇┈┉┊┋┌┍┎┏┐┑┒┓└┕┖┗┘┙┚┛├┝┞┟┠┡┢┣┤┥┦┧┨┩┪┫┬┭┮┯┰┱┲┳┴┵┶┷┸┹┺┻┼┽┾┿╀╁╂╃╄╅╆╇╈╉╊╋╌╍╎╏═║╒╓╔╕╖╗╘╙╚╛╜╝╞╟╠╡╢╣╤╥╦╧╨╩╪╫╬╭╮╯╰╱╲╳╴╵╶╷╸╹╺╻╼╽╾╿▀ ▂▃▄▅▆▇█▉▊▋▌▍▎▏▐░▒▓▔▕▖▗▘▙▚▛▜▝▞▟■□▢▣▤▥▦▧▨▩▪▫▬▭▮▯▰▱▲△▴▵▶▷▸▹►▻▼▽▾▿◀◁◂◃◄◅◆◇◈◉◊○◌◍◎●◐◑◒◓◔◕◖◗◘◙◚◛◜◝◞◟◠◡◢◣◤◥◦◧◨◩◪◫◬◭◮◯◰◱◲◳◴◵◶◷◸◹◺◻◼◽◾◿",
                enabled: false,
                description: 'Drawing and geometric elements.'
            },
            'Dingbats & Misc': {
                value: "★☆☀☁☂☃☄☠☢☣♠♣♥♦♪♫✔✖✳❄‼©€¡¢£¤¥¦§¨ª«¬®¯°±²³´µ¶·¸¹º»¼½¾¿ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõö÷øùúûüýþÿŁłŃńŅņŇňŊŋŌōŎŏŐőŒœŔŕŖŗŘřŚśŜŝŞşŠšŢţŤťŦŧŨũŪūŬŭŮůŰůŴŵŶŷŸŹźŻżŽžſƆƎƜɐɑɒɔɘəɛɜɞɟɡɢɥɨɪɬɮɯɰɴɵɶɷɸɹʁʇʌʍʎʞ",
                enabled: false,
                description: 'Punctuation, arrows, chess, and card symbols.'
            },
            'Emoji': {
                value: "☹☺☻☼☽☾☿♀♁♂♃♄♅♆♇♈♉♊♋♌♍♎♏♐♑♒♓♔♕♖♗♘♙♚♛♜♝♞♟♠♡♢♣♤♥♦♧♨♩♪♫♬♭♮♯♲♳♴♵♶♷♸♹♺♻♼♽♾♿⚀⚁⚂⚃⚄⚅⚐⚑⚒⚓⚔⚕⚖⚗⚘⚙⚛⚜⚝⚞⚟⚠⚡⚢⚣⚤⚥⚦⚧⚨⚩⚪⚫⚬⚭⚮⚯⚰⚱⚲⚳⚴⚵⚶⚷⚸⚹⚺⚻⚼⛀⛁⛂⛃⛢⛤⛥⛦⛧⛨⛩⛪⛫⛬⛭⛮⛯⛰⛱⛲⛳⛴⛵⛶⛷⛸⛹⛺⛻⛼⛽⛾⛿✁✂✃✄✅✆✇✈✉✊✋✌✍✎✏✐✑✒✓✔✕✖✗✘✙✚✛✜✝✞✟✠✡✢✣✤✥✦✧✨✩✪✫✬✭✮✯✰✱✲✳✴✵✶✷✸✹✺✻✼✽✾✿❀❁❂❃❄❅❆❇❈❉❊❋❌❍❎❏❐❑❒❓❔❕❖❗❘❙❚❛❜❝❞❟❠❡❢❣❤❥❦❧➔➘➙➚➛➜➝➞➟➠➡➢➣➤➥➦➧➨➩➪➫➬➭➮➯➱➲➳➴➵➶➷➸➹➺➻➼➽➾⟰⟱⟲⟳⟴⟵⟶⟷⟸⟹⟺⟻⟼⟽⟾⟿⤀⤁⤂⤃⤄⤅⤆⤇⤈⤉⤊⤋⤌⤍⤎⤏⤐⤑⤒⤓⤔⤕⤖⤗⤘⤙⤚⤛⤜⤝⤞⤟⤠⤡⤢⤣⤤⤥⤦⤧⤨⤩⤪⤫⤬⤭⤮⤯⤰⤱⤲⤳⤴⤵⤶⤷⤸⤹⤺⤻⤼⤽⤾⤿0⥁⥂⥃⥄⥅⥆⥇⥈⥉⥊⥋⥌⥍⥎⥏⥐1⬀⬁⬂⬃⬄⬅⬆⬇⬈⬉⬊⬋⬌⬍⬎⬏⬐1⬒⬓⬔⬕⬖⬗⬘⬙⬚",
                enabled: false,
                description: 'Various emoji, zodiac, and cultural symbols.'
            }
        };

        const RENDER_THRESHOLD = 25; // Max number of passwords to render individually
        let lastGeneratedPasswords = []; // Stores the last generated array for download
        let activePool = ""; // The dynamically calculated pool

        // --- Utility Functions ---

        /**
         * Calculates Shannon Entropy: H = L * log2(N)
         * @param {number} length - The length of the password.
         * @param {number} poolSize - The size of the character pool.
         * @returns {string} The entropy value, rounded to two decimal places.
         */
        function calculateEntropy(length, poolSize) {
            if (poolSize <= 1 || length <= 0) return 0.00;
            // Math.log2 is standard in modern JS environments
            const entropy = length * Math.log2(poolSize);
            return entropy.toFixed(2);
        }

        /**
         * Rates password strength based on entropy bits.
         * @param {string} entropy - The calculated entropy as a string.
         * @returns {{rating: string, color: string}} The strength rating and corresponding Tailwind color class.
         */
        function rateEntropy(entropy) {
            const e = parseFloat(entropy);
            if (e < 40) return { rating: "Very Weak (< 1h)", color: "text-red-500" };
            if (e < 60) return { rating: "Weak (< 1 day)", color: "text-orange-500" };
            if (e < 80) return { rating: "Moderate (~1 year)", color: "text-yellow-500" };
            if (e < 100) return { rating: "Strong (~1000 years)", color: "text-blue-400" };
            return { rating: "Very Strong (> 1 million years)", color: "text-green-500" };
        }

        /**
         * Generates a secure password using cryptographically random values.
         * @param {number} length - The desired password length.
         * @param {string} pool - The active character pool string.
         * @returns {string} The generated password.
         */
        function generatePassword(length, pool) {
            if (length <= 0 || pool.length === 0) return "";
            let password = '';
            const poolLength = pool.length;

            // Generate enough random bytes (Uint32 is 4 bytes, allowing a large range)
            const randomBytes = new Uint32Array(length);
            // window.crypto is the browser's cryptographically secure random number generator
            window.crypto.getRandomValues(randomBytes);

            for (let i = 0; i < length; i++) {
                // Use modulus operation to map the random number to an index within the pool
                const randomIndex = randomBytes[i] % poolLength;
                password += pool.charAt(randomIndex);
            }
            return password;
        }

        /**
         * Saves the globally stored passwords to a local .txt file.
         */
        function downloadPasswords() {
            if (lastGeneratedPasswords.length === 0) {
                // Use the notification system instead of alert()
                showBashCopyNotification("Nothing to download. Generate passwords first!", "bg-orange-600");
                return;
            }

            // Create a single string with each password on a new line
            const textContent = lastGeneratedPasswords.join('\n');
            const blob = new Blob([textContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);

            // Create a temporary anchor element for download
            const a = document.createElement('a');
            a.href = url;
            a.download = `unicode_passwords_${lastGeneratedPasswords.length}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            // Clean up the URL object
            URL.revokeObjectURL(url);
            showBashCopyNotification("Download initiated!", "bg-teal-600");
        }

        /**
         * Function to handle copying text (using execCommand for better iFrame compatibility)
         */
        function copyToClipboard(text) {
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = text;
            tempTextArea.style.position = "fixed"; // Prevents scrolling
            tempTextArea.style.opacity = "0"; // Invisible
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            try {
                // For cross-browser compatibility in iframes
                const successful = document.execCommand('copy');
                return successful;
            } catch (err) {
                console.error('Copy failed:', err);
                return false;
            } finally {
                document.body.removeChild(tempTextArea);
            }
        }

        /**
         * Shows a temporary notification at the bottom of the screen.
         * @param {string} message - The message to display.
         * @param {string} [bgColor="bg-indigo-700"] - Optional Tailwind background color class.
         */
        function showBashCopyNotification(message, bgColor = "bg-indigo-700") {
            const notification = document.getElementById('bash-copy-notification');
            // Reset classes
            notification.className = "hidden fixed bottom-4 left-1/2 transform -translate-x-1/2 text-white px-4 py-2 rounded-lg shadow-xl transition-opacity duration-300 z-50 opacity-0 font-semibold";
            notification.classList.add(bgColor);
            
            notification.textContent = message;
            notification.classList.remove('hidden', 'opacity-0');
            notification.classList.add('opacity-100');

            setTimeout(() => {
                notification.classList.remove('opacity-100');
                notification.classList.add('opacity-0');
                // Hide completely after the transition ends
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 300); // Matches the transition duration
            }, 2000);
        }
        
        /**
         * Synchronizes the value between a slider and its corresponding number input and display span.
         * @param {HTMLElement} slider - The range input element.
         * @param {HTMLElement} input - The number input element.
         * @param {HTMLElement} display - The span element to show the value.
         * @param {boolean} fromSlider - True if the event originated from the slider.
         */
        function syncSliderAndInput(slider, input, display, fromSlider = false) {
            let value = parseFloat(fromSlider ? slider.value : input.value);
            const min = parseFloat(input.min);
            const maxInput = parseFloat(input.max);
            
            // Note: Slider max (100) and Input max (10000) are different for count, we use input max for validation

            // Constraint check for input box (use the input's max/min)
            if (value < min) {
                value = min;
                input.value = min;
            } else if (value > maxInput) {
                value = maxInput;
                input.value = maxInput;
            }
            
            // Update the slider's value only if it's within the slider's physical range
            const sliderMax = parseFloat(slider.max);
            if (value >= min && value <= sliderMax) {
                 slider.value = value;
            } else if (value > sliderMax) {
                // If value is manually typed past the slider's max (e.g., 500 in count), snap slider to max
                slider.value = sliderMax;
            }


            // Update input and display (always use the validated value)
            input.value = value;
            display.textContent = value.toLocaleString();

            // Then recalculate entropy
            updatePoolAndEntropy();
        }

        // --- Core Logic ---

        /**
         * Updates the activePool string and recalculates entropy based on current settings.
         */
        function updatePoolAndEntropy() {
            const lengthInput = document.getElementById('length-input');
            
            let currentPool = "";
            let poolCount = 0;
            // Read length value from the input field
            const length = parseInt(lengthInput.value) || 0; 
            const charsetOptionsDiv = document.getElementById('charset-options');
            const warningElement = document.getElementById('charset-warning');
            const generateButton = document.getElementById('generate-button');

            // 1. Build the active pool
            Object.keys(CHAR_SETS).forEach(key => {
                // Ensure ID generation matches setupCharsetOptions
                const id = `charset-${key.replace(/[^a-zA-Z0-9]/g, '-')}`;
                const checkbox = document.getElementById(id);

                if (checkbox && checkbox.checked) {
                    // This is slightly defensive; the structure prevents duplicates
                    currentPool += CHAR_SETS[key].value;
                }
            });

            // Remove duplicate characters just in case, though the defined sets minimize this
            activePool = [...new Set(currentPool)].join('');
            poolCount = activePool.length;

            // 2. Update UI stats
            const entropy = calculateEntropy(length, poolCount);
            const strength = rateEntropy(entropy);

            document.getElementById('pool-size').textContent = `${poolCount.toLocaleString()} unique characters`;
            document.getElementById('entropy-bits').textContent = `${entropy} bits`;
            document.getElementById('strength-rating').textContent = strength.rating;
            // Update class to reflect strength color
            document.getElementById('strength-rating').className = `${strength.color} text-2xl font-extrabold mt-1`;

            // 3. Handle minimum pool size for generation
            if (poolCount === 0) {
                warningElement.classList.remove('hidden');
                generateButton.disabled = true;
                generateButton.classList.add('cursor-not-allowed');
                document.getElementById('download-button').disabled = true;
            } else {
                warningElement.classList.add('hidden');
                generateButton.disabled = false;
                generateButton.classList.remove('cursor-not-allowed');
                document.getElementById('download-button').disabled = (lastGeneratedPasswords.length === 0);
            }
        }

        /**
         * Generates and displays the requested number of passwords.
         */
        async function generateAndDisplayPasswords() {
            const now = Date.now();
            const timeSinceLastGeneration = now - lastGenerationTime;
            const outputDiv = document.getElementById('password-output');

            // --- RATE LIMIT CHECK ---
            if (timeSinceLastGeneration < COOLDOWN_MS) {
                // Calculate remaining time for user feedback
                const remainingTime = ((COOLDOWN_MS - timeSinceLastGeneration) / 1000).toFixed(2);
                outputDiv.innerHTML = `<p class="text-red-400 text-center py-4 font-semibold animate-pulse">Please wait ${remainingTime}s before generating again (500ms cooldown).</p>`;
                return;
            }

            // Set the new last generation time right before starting
            lastGenerationTime = now;

            const lengthInput = document.getElementById('length-input');
            const countInput = document.getElementById('count-input');
            const generateButton = document.getElementById('generate-button');
            const generateText = document.getElementById('generate-text');
            const loadingSpinner = document.getElementById('loading-spinner');
            const downloadCount = document.getElementById('download-count');

            let length = parseInt(lengthInput.value) || 8;
            let count = parseInt(countInput.value) || 1;

            // Input Validation (already constrained by syncSliderAndInput but repeated for safety)
            length = Math.min(Math.max(length, 8), 128);
            count = Math.min(Math.max(count, 1), 10000);

            // Re-sync values just in case
            lengthInput.value = length;
            countInput.value = count;

            if (activePool.length === 0) return; // Should be disabled by updatePoolAndEntropy

            // Set loading state
            generateButton.disabled = true;
            generateButton.classList.add('cursor-wait');
            generateText.textContent = "Generating...";
            loadingSpinner.classList.remove('hidden');
            outputDiv.innerHTML = '<p class="text-indigo-400 text-center py-4 animate-pulse">Generating security tokens...</p>';

            // Wait a moment to allow the UI to update
            await new Promise(resolve => setTimeout(resolve, 50));

            // 1. Generate Passwords
            const passwords = [];
            for (let i = 0; i < count; i++) {
                passwords.push(generatePassword(length, activePool));
            }
            lastGeneratedPasswords = passwords; // Store for download
            downloadCount.textContent = passwords.length.toLocaleString();
            document.getElementById('download-button').disabled = false;

            // 2. Display Passwords/Summary
            outputDiv.innerHTML = ''; // Clear previous output

            if (count > RENDER_THRESHOLD) {
                // Display summary for large batches (no individual rendering for performance)
                outputDiv.innerHTML = `
                    <div class="p-6 bg-yellow-900/50 border border-yellow-500 rounded-xl text-yellow-300 shadow-inner">
                        <p class="font-bold text-xl mb-2 flex items-center">
                            <!-- Checkmark Icon -->
                            <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            Generation Complete
                        </p>
                        <p>Successfully generated <span class="font-bold">${count.toLocaleString()}</span> passwords of length <span class="font-bold">${length}</span>.</p>
                        <p class="mt-3 text-sm">Individual passwords are not displayed here due to performance limits. Please use the <strong>Download Button</strong> below to save the complete list securely.</p>
                    </div>
                `;
            } else {
                // Render individual passwords for small batches
                passwords.forEach((pwd, index) => {
                    const passwordItem = document.createElement('div');
                    passwordItem.className = 'password-container relative flex items-center justify-between p-4 bg-gray-600 rounded-lg transition duration-200 shadow-md border border-gray-500 hover:bg-gray-500';
                    passwordItem.innerHTML = `
                        <span class="text-sm font-semibold text-indigo-400 mr-4 whitespace-nowrap">#${index + 1}:</span>
                        <code class="flex-grow text-lg break-all font-mono text-gray-100">${pwd}</code>
                        <button class="copy-button ml-4 p-2 rounded-full bg-indigo-700 hover:bg-indigo-600 transition duration-300 shadow-lg flex-shrink-0"
                                data-password="${pwd}" title="Copy to Clipboard">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v7M8 5H6M4 12H3m14 0h1m-5 0v3m0 0v-3"></path></svg>
                        </button>
                    `;
                    outputDiv.appendChild(passwordItem);

                    // Add click handler to the newly created copy button
                    passwordItem.querySelector('.copy-button').addEventListener('click', (event) => {
                        const passwordToCopy = event.currentTarget.dataset.password;
                        if (copyToClipboard(passwordToCopy)) {
                            showBashCopyNotification("Password copied!");
                        }
                    });
                });
            }

            // 3. Reset Loading State
            generateButton.disabled = false;
            generateButton.classList.remove('cursor-wait');
            generateText.textContent = "Generate Passwords";
            loadingSpinner.classList.add('hidden');
        }

        /**
         * Dynamically generates the character set checkboxes.
         */
        function setupCharsetOptions() {
            const container = document.getElementById('charset-options');
            Object.keys(CHAR_SETS).forEach(key => {
                // Replace non-alphanumeric for a safe ID
                const id = `charset-${key.replace(/[^a-zA-Z0-9]/g, '-')}`;
                const item = CHAR_SETS[key];
                const checked = item.enabled ? 'checked' : '';

                const html = `
                    <label for="${id}" class="flex items-start space-x-2 cursor-pointer p-2 rounded-lg bg-gray-600 hover:bg-gray-500 transition duration-150">
                        <input type="checkbox" id="${id}" ${checked} name="charset" value="${key}" class="mt-0.5 h-4 w-4 text-indigo-600 bg-gray-700 border-gray-500 rounded focus:ring-indigo-500">
                        <div class="leading-tight">
                            <span class="font-semibold text-gray-100">${key}</span>
                            <p class="text-xs text-gray-400">${item.description}</p>
                        </div>
                    </label>
                `;
                container.innerHTML += html;
            });
        }

        /**
         * Sets up all necessary event listeners for the application.
         */
        function setupEventListeners() {
            
            // --- Elements for Length ---
            const lengthInput = document.getElementById('length-input');
            const lengthSlider = document.getElementById('length-slider');
            const lengthDisplay = document.getElementById('length-display');

            // --- Elements for Count ---
            const countInput = document.getElementById('count-input');
            const countSlider = document.getElementById('count-slider');
            const countDisplay = document.getElementById('count-display');

            // 1. Length Listeners
            lengthSlider.addEventListener('input', () => syncSliderAndInput(lengthSlider, lengthInput, lengthDisplay, true));
            lengthInput.addEventListener('change', () => syncSliderAndInput(lengthSlider, lengthInput, lengthDisplay, false));

            // 2. Count Listeners
            countSlider.addEventListener('input', () => syncSliderAndInput(countSlider, countInput, countDisplay, true));
            countInput.addEventListener('change', () => syncSliderAndInput(countSlider, countInput, countDisplay, false));


            // 3. Checkboxes (for real-time entropy calculation)
            const charsetOptionsDiv = document.getElementById('charset-options');
            charsetOptionsDiv.addEventListener('change', (e) => {
                if (e.target.type === 'checkbox') {
                    updatePoolAndEntropy();
                }
            });

            // 4. Generate Button
            document.getElementById('generate-button').addEventListener('click', generateAndDisplayPasswords);

            // 5. Download Button
            document.getElementById('download-button').addEventListener('click', downloadPasswords);

            // 6. Copy Bash Script Button
            const bashScriptCode = document.getElementById('bash-script-code').textContent;
            document.getElementById('copy-bash-button').addEventListener('click', () => {
                if (copyToClipboard(bashScriptCode)) {
                    showBashCopyNotification("Bash Script copied to clipboard!", "bg-red-600");
                }
            });
        }

        /**
         * Initializes the entire application on load.
         */
        function initApp() {
            setupCharsetOptions();
            setupEventListeners();
            
            // Initial synchronization to set values and entropy stats correctly
            const lengthInput = document.getElementById('length-input');
            const lengthSlider = document.getElementById('length-slider');
            const lengthDisplay = document.getElementById('length-display');
            syncSliderAndInput(lengthSlider, lengthInput, lengthDisplay, false);

            const countInput = document.getElementById('count-input');
            const countSlider = document.getElementById('count-slider');
            const countDisplay = document.getElementById('count-display');
            syncSliderAndInput(countSlider, countInput, countDisplay, false);

            // Initial call to set pool size, entropy, and button state
            updatePoolAndEntropy(); 
        }

        window.onload = initApp;
    </script>
</body>
</html>

</body>
</html>
