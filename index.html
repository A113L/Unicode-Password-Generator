<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNICODE Password Utility</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Font Setup */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for the password display and copy button */
        .password-container:hover .copy-icon {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-4xl bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-10 border border-indigo-700/50">
        
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold text-indigo-400 mb-2 tracking-tight">
                UNICODE Password Utility
            </h1>
            <p class="text-xl text-gray-400">
                Cryptographically secure generation using a massive character pool.
            </p>
        </header>

        <!-- Generation Parameters -->
        <section class="mb-8 p-6 bg-gray-700 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold text-gray-100 mb-4 border-b border-indigo-600 pb-2">Generation Settings</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- Password Length -->
                <div>
                    <label for="length" class="block text-sm font-medium text-gray-300 mb-2">Password Length</label>
                    <input type="number" id="length" value="20" min="8" max="128"
                           class="w-full p-3 rounded-lg bg-gray-600 border border-gray-500 text-gray-100 focus:ring-indigo-500 focus:border-indigo-500 appearance-none transition duration-150">
                    <p class="mt-1 text-sm text-gray-400">Recommended: 16 to 32 characters.</p>
                </div>

                <!-- Number of Passwords -->
                <div>
                    <label for="count" class="block text-sm font-medium text-gray-300 mb-2">Number of Passwords</label>
                    <input type="number" id="count" value="3" min="1" max="10"
                           class="w-full p-3 rounded-lg bg-gray-600 border border-gray-500 text-gray-100 focus:ring-indigo-500 focus:border-indigo-500 appearance-none transition duration-150">
                    <p class="mt-1 text-sm text-gray-400">Generate multiple passwords at once.</p>
                </div>
            </div>
            
            <!-- Generate Button -->
            <button id="generate-button"
                    class="mt-8 w-full py-4 text-xl font-bold rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white transition duration-300 transform hover:scale-[1.01] shadow-xl shadow-indigo-500/30">
                Generate Passwords
            </button>
        </section>

        <!-- Entropy and Strength Display -->
        <section class="mb-8 p-6 bg-gray-700 rounded-xl shadow-lg grid grid-cols-1 md:grid-cols-2 gap-4">
            
            <!-- Pool Size -->
            <div class="bg-gray-600 p-4 rounded-lg">
                <p class="text-sm font-medium text-gray-300">Character Pool Size</p>
                <p id="pool-size" class="text-2xl font-extrabold text-white mt-1">...</p>
            </div>
            
            <!-- Entropy -->
            <div class="bg-gray-600 p-4 rounded-lg">
                <p class="text-sm font-medium text-gray-300">Calculated Entropy</p>
                <p id="entropy-bits" class="text-2xl font-extrabold text-white mt-1">0.00 bits</p>
            </div>

            <!-- Strength Rating -->
            <div class="md:col-span-2 bg-gray-600 p-4 rounded-lg">
                <p class="text-sm font-medium text-gray-300">Estimated Strength Rating</p>
                <p id="strength-rating" class="text-2xl font-extrabold text-red-500 mt-1">N/A</p>
            </div>
        </section>

        <!-- Password Output -->
        <section class="mb-8 p-6 bg-gray-800 rounded-xl">
            <h2 class="text-2xl font-bold text-gray-100 mb-4 border-b border-indigo-600 pb-2">Generated Passwords</h2>
            <div id="password-output" class="space-y-3">
                <p class="text-gray-400 text-center py-4">Click "Generate Passwords" to begin.</p>
            </div>
        </section>
    </div>

    <script>
        const UNICODE_POOL = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~" +
            "ąćęłńóśźżĄĆĘŁŃÓŚŹŻäöüßÄÖÜ" +
            "абвгдеёжзийклмнопрстуфхцчшщъыьэюяАБВГДЕЁЖЗИЙКЛМНОПРСТФХЦЧШЩЪЫЬЭЮЯ" +
            "èéêëēėęùúûüūîïíīįìôöòóœøãåáàâæçñ" +
            "กขคฆงจฉชซฌญฎฏฐฑฒณดตถทธนบปผฝพฟภมยรฤลฦวศษสหฬอฮ" +
            "अआइईउऊऋएऐओऔकखगघचछजझटठडढणतथदधनपफबभमयरलवशषसह" +
            "あいうえおかきくけこさしすせそたちつてとなにぬねのアイウエオカキクケコサシスセソタチツテトナニヌネノ" +
            "漢字日本語中文测试字符∞±≠∑∏√∫∂∆πµΩ≈≡≤≥∇¢£¥€₩₪₹₽฿₫₴₦₲" +
            "★☆☀☁☂☃☄☠☢☣♠♣♥♦♪♫✔✖✳❄‼";
        
        const POOL_SIZE = UNICODE_POOL.length;

        // Display the pool size on load
        document.getElementById('pool-size').textContent = `${POOL_SIZE} unique characters`;

        // --- Entropy Calculation Functions ---

        /**
         * Calculates Shannon Entropy: H = L * log2(N)
         * @param {number} length - The length of the password.
         * @param {number} poolSize - The size of the character pool.
         * @returns {string} The entropy value, rounded to two decimal places.
         */
        function calculateEntropy(length, poolSize) {
            if (poolSize <= 1 || length <= 0) return 0.00;
            // Math.log2 is standard in modern JS environments
            const entropy = length * Math.log2(poolSize);
            return entropy.toFixed(2);
        }

        /**
         * Rates password strength based on entropy bits.
         * @param {string} entropy - The calculated entropy as a string.
         * @returns {{rating: string, color: string}} The strength rating and corresponding Tailwind color class.
         */
        function rateEntropy(entropy) {
            const e = parseFloat(entropy);
            if (e < 40) return { rating: "Very Weak", color: "text-red-500" };
            if (e < 60) return { rating: "Weak", color: "text-orange-500" };
            if (e < 80) return { rating: "Moderate", color: "text-yellow-500" };
            if (e < 100) return { rating: "Strong", color: "text-blue-500" };
            return { rating: "Very Strong", color: "text-green-500" };
        }

        // --- Password Generation Function (Cryptographically Secure) ---

        /**
         * Generates a secure password using cryptographically random values.
         * @param {number} length - The desired password length.
         * @returns {string} The generated password.
         */
        function generatePassword(length) {
            if (length <= 0) return "";
            let password = '';
            const poolLength = UNICODE_POOL.length;
            
            // Generate enough random bytes (Uint32 is 4 bytes, allowing a large range)
            const randomBytes = new Uint32Array(length);
            // window.crypto is the browser's cryptographically secure random number generator
            window.crypto.getRandomValues(randomBytes);

            for (let i = 0; i < length; i++) {
                // Use modulus operation to map the random number to an index within the pool
                const randomIndex = randomBytes[i] % poolLength;
                password += UNICODE_POOL.charAt(randomIndex);
            }
            return password;
        }
        
        // --- UI Rendering and Event Handling ---

        document.getElementById('generate-button').addEventListener('click', () => {
            const lengthInput = document.getElementById('length');
            const countInput = document.getElementById('count');
            
            let length = parseInt(lengthInput.value);
            let count = parseInt(countInput.value);

            // Input Validation and correction
            if (isNaN(length) || length < 8) length = 8;
            if (isNaN(count) || count < 1) count = 1;

            lengthInput.value = length; // Update UI if corrected
            countInput.value = count;   // Update UI if corrected

            // 1. Calculate and display Entropy
            const entropy = calculateEntropy(length, POOL_SIZE);
            const strength = rateEntropy(entropy);
            
            document.getElementById('entropy-bits').textContent = `${entropy} bits`;
            document.getElementById('strength-rating').textContent = strength.rating;
            document.getElementById('strength-rating').className = `${strength.color} text-2xl font-extrabold mt-1`;

            // 2. Generate and display Passwords
            const outputDiv = document.getElementById('password-output');
            outputDiv.innerHTML = ''; // Clear previous output
            
            const passwords = [];
            for (let i = 0; i < count; i++) {
                passwords.push(generatePassword(length));
            }

            // Function to handle copying text (using execCommand for better iFrame compatibility)
            function copyToClipboard(text) {
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = text;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                try {
                    document.execCommand('copy');
                    return true;
                } catch (err) {
                    console.error('Copy failed:', err);
                    return false;
                } finally {
                    document.body.removeChild(tempTextArea);
                }
            }

            passwords.forEach((pwd, index) => {
                const passwordItem = document.createElement('div');
                passwordItem.className = 'password-container relative flex items-center justify-between p-4 bg-gray-600 rounded-lg transition duration-200 shadow-md border border-gray-500';
                passwordItem.innerHTML = `
                    <span class="text-sm font-semibold text-indigo-400 mr-4">#${index + 1}:</span>
                    <code class="flex-grow text-lg break-all font-mono text-gray-100">${pwd}</code>
                    <button class="copy-button ml-4 p-2 rounded-full bg-indigo-700 hover:bg-indigo-600 transition duration-300 transform translate-y-1 opacity-0 md:opacity-100" 
                            data-password="${pwd}" title="Copy to Clipboard">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v7M8 5H6M4 12H3m14 0h1m-5 0v3m0 0v-3"></path></svg>
                    </button>
                `;
                outputDiv.appendChild(passwordItem);
            });
            
            // Add event listeners to copy buttons
            document.querySelectorAll('.copy-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const textToCopy = e.currentTarget.getAttribute('data-password');
                    if (copyToClipboard(textToCopy)) {
                        const originalContent = e.currentTarget.innerHTML;
                        e.currentTarget.innerHTML = '<svg class="w-5 h-5 text-green-300" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>'; // Checkmark
                        
                        setTimeout(() => {
                            e.currentTarget.innerHTML = originalContent;
                        }, 1500);
                    }
                });
            });
        });

        // Trigger generation on load to populate initial entropy/size
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('generate-button').click();
        });

    </script>
</body>
</html>
